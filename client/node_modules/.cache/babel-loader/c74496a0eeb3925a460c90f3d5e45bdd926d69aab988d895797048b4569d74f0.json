{"ast":null,"code":"import { ref, computed, onMounted, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nexport default {\n  name: \"SpinWheelStep\",\n  setup() {\n    const store = useStore();\n    const wheelCanvas = ref(null);\n    const isSpinning = ref(false);\n    const rotation = ref(0);\n    const choices = computed(() => store.state.choices);\n    const customization = computed(() => store.state.wheelCustomization);\n    const drawWheel = () => {\n      const canvas = wheelCanvas.value;\n      const ctx = canvas.getContext(\"2d\");\n      const centerX = canvas.width / 2;\n      const centerY = canvas.height / 2;\n      const radius = Math.min(centerX, centerY) - 10;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n      ctx.translate(centerX, centerY);\n      ctx.rotate(rotation.value);\n      const totalWeight = choices.value.reduce((sum, choice) => sum + choice.weight, 0);\n      let startAngle = 0;\n      choices.value.forEach((choice, index) => {\n        const anglePerChoice = 2 * Math.PI * choice.weight / totalWeight;\n        const endAngle = startAngle + anglePerChoice;\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(0, 0, radius, startAngle, endAngle);\n        ctx.closePath();\n\n        // Color logic\n        let color;\n        if (customization.value.colors && customization.value.colors[index]) {\n          color = customization.value.colors[index];\n        } else {\n          const hue = index * 137.5 % 360;\n          color = `hsl(${hue}, 70%, 50%)`;\n        }\n        ctx.fillStyle = color;\n        ctx.fill();\n\n        // Draw text\n        ctx.save();\n        ctx.rotate(startAngle + anglePerChoice / 2);\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        ctx.fillStyle = \"white\";\n        ctx.font = \"14px Arial\";\n        ctx.translate(radius / 2, 0);\n        ctx.rotate(Math.PI);\n        ctx.fillText(choice.name, 0, 0);\n        ctx.restore();\n        startAngle = endAngle;\n      });\n      ctx.restore();\n    };\n    const spinWheel = () => {\n      if (isSpinning.value) return;\n      isSpinning.value = true;\n      const totalRotation = 2 * Math.PI * (5 + Math.random()); // 5-6 full rotations\n      const duration = 5000; // 5 seconds\n      const start = performance.now();\n      const animate = time => {\n        const elapsed = time - start;\n        const progress = Math.min(elapsed / duration, 1);\n        const easeProgress = 1 - Math.pow(1 - progress, 4); // Ease out quartic\n\n        rotation.value = totalRotation * easeProgress;\n        drawWheel();\n        if (progress < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          // Calculate the result based on the final position of the wheel\n          const normalizedRotation = (2 * Math.PI - rotation.value % (2 * Math.PI)) % (2 * Math.PI);\n          const anglePerChoice = 2 * Math.PI / choices.value.length;\n          const choiceIndex = Math.floor(normalizedRotation / anglePerChoice);\n          const result = choices.value[choiceIndex];\n          console.log(\"Final rotation:\", rotation.value);\n          console.log(\"Normalized rotation:\", normalizedRotation);\n          console.log(\"Choice index:\", choiceIndex);\n          console.log(\"Selected result:\", result);\n          store.commit(\"setResult\", result);\n          store.commit(\"setCurrentStep\", 6);\n          isSpinning.value = false;\n        }\n      };\n      requestAnimationFrame(animate);\n    };\n    onMounted(() => {\n      drawWheel();\n    });\n    watch([choices, customization], () => {\n      drawWheel();\n    });\n    return {\n      wheelCanvas,\n      isSpinning,\n      spinWheel\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useStore","name","setup","store","wheelCanvas","isSpinning","rotation","choices","state","customization","wheelCustomization","drawWheel","canvas","value","ctx","getContext","centerX","width","centerY","height","radius","Math","min","clearRect","save","translate","rotate","totalWeight","reduce","sum","choice","weight","startAngle","forEach","index","anglePerChoice","PI","endAngle","beginPath","moveTo","arc","closePath","color","colors","hue","fillStyle","fill","textAlign","textBaseline","font","fillText","restore","spinWheel","totalRotation","random","duration","start","performance","now","animate","time","elapsed","progress","easeProgress","pow","requestAnimationFrame","normalizedRotation","length","choiceIndex","floor","result","console","log","commit"],"sources":["/Users/hyemin/Documents/Projects/decision-maker/client/src/components/SpinWheelStep.vue"],"sourcesContent":["<template>\n  <div class=\"spin-wheel-step\">\n    <h2>Spin the Wheel</h2>\n    <div class=\"wheel-container\">\n      <canvas ref=\"wheelCanvas\" width=\"400\" height=\"400\"></canvas>\n      <div class=\"wheel-arrow\"></div>\n    </div>\n    <button @click=\"spinWheel\" :disabled=\"isSpinning\">\n      {{ isSpinning ? \"Spinning...\" : \"Spin\" }}\n    </button>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, watch } from \"vue\";\nimport { useStore } from \"vuex\";\n\nexport default {\n  name: \"SpinWheelStep\",\n  setup() {\n    const store = useStore();\n    const wheelCanvas = ref(null);\n    const isSpinning = ref(false);\n    const rotation = ref(0);\n    const choices = computed(() => store.state.choices);\n    const customization = computed(() => store.state.wheelCustomization);\n\n    const drawWheel = () => {\n      const canvas = wheelCanvas.value;\n      const ctx = canvas.getContext(\"2d\");\n      const centerX = canvas.width / 2;\n      const centerY = canvas.height / 2;\n      const radius = Math.min(centerX, centerY) - 10;\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n      ctx.translate(centerX, centerY);\n      ctx.rotate(rotation.value);\n\n      const totalWeight = choices.value.reduce((sum, choice) => sum + choice.weight, 0);\n      let startAngle = 0;\n\n      choices.value.forEach((choice, index) => {\n        const anglePerChoice = (2 * Math.PI * choice.weight) / totalWeight;\n        const endAngle = startAngle + anglePerChoice;\n\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(0, 0, radius, startAngle, endAngle);\n        ctx.closePath();\n\n        // Color logic\n        let color;\n        if (customization.value.colors && customization.value.colors[index]) {\n          color = customization.value.colors[index];\n        } else {\n          const hue = (index * 137.5) % 360;\n          color = `hsl(${hue}, 70%, 50%)`;\n        }\n        ctx.fillStyle = color;\n        ctx.fill();\n\n        // Draw text\n        ctx.save();\n        ctx.rotate(startAngle + anglePerChoice / 2);\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        ctx.fillStyle = \"white\";\n        ctx.font = \"14px Arial\";\n        ctx.translate(radius / 2, 0);\n        ctx.rotate(Math.PI);\n        ctx.fillText(choice.name, 0, 0);\n        ctx.restore();\n\n        startAngle = endAngle;\n      });\n\n      ctx.restore();\n    };\n\n    const spinWheel = () => {\n      if (isSpinning.value) return;\n\n      isSpinning.value = true;\n      const totalRotation = 2 * Math.PI * (5 + Math.random()); // 5-6 full rotations\n      const duration = 5000; // 5 seconds\n      const start = performance.now();\n\n      const animate = (time) => {\n        const elapsed = time - start;\n        const progress = Math.min(elapsed / duration, 1);\n        const easeProgress = 1 - Math.pow(1 - progress, 4); // Ease out quartic\n\n        rotation.value = totalRotation * easeProgress;\n\n        drawWheel();\n\n        if (progress < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          // Calculate the result based on the final position of the wheel\n          const normalizedRotation =\n            (2 * Math.PI - (rotation.value % (2 * Math.PI))) % (2 * Math.PI);\n\n          const anglePerChoice = (2 * Math.PI) / choices.value.length;\n          const choiceIndex = Math.floor(normalizedRotation / anglePerChoice);\n\n          const result = choices.value[choiceIndex];\n\n          console.log(\"Final rotation:\", rotation.value);\n          console.log(\"Normalized rotation:\", normalizedRotation);\n          console.log(\"Choice index:\", choiceIndex);\n          console.log(\"Selected result:\", result);\n\n          store.commit(\"setResult\", result);\n          store.commit(\"setCurrentStep\", 6);\n          isSpinning.value = false;\n        }\n      };\n\n      requestAnimationFrame(animate);\n    };\n\n    onMounted(() => {\n      drawWheel();\n    });\n\n    watch([choices, customization], () => {\n      drawWheel();\n    });\n\n    return {\n      wheelCanvas,\n      isSpinning,\n      spinWheel,\n    };\n  },\n};\n</script>\n\n<style scoped>\n.wheel-container {\n  position: relative;\n  width: 400px;\n  height: 400px;\n  margin: 0 auto;\n}\n\n.wheel-arrow {\n  position: absolute;\n  top: 0;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-left: 20px solid transparent;\n  border-right: 20px solid transparent;\n  border-top: 40px solid #333;\n  transform: translateX(-50%);\n}\n\nbutton {\n  margin-top: 20px;\n  padding: 10px 20px;\n  font-size: 18px;\n  cursor: pointer;\n}\n\nbutton:disabled {\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}